name: Build Release

on:
  release:
    types: [published]

jobs:
  build-windows:
    name: Build on Windows
    runs-on: windows-latest

    steps:
      - name: Checkout repo
        uses: actions/checkout@v4

      - name: Install dependencies
        run: |
          choco install mingw -y
          echo "PATH=C:\ProgramData\chocolatey\lib\mingw\tools\install\mingw64\bin;$PATH" >> $env:GITHUB_ENV

      - name: Configure CMake
        run: cmake -B build -G "MinGW Makefiles"

      - name: Build
        run: cmake --build build --config Release

      - name: Find exe
        id: find_exe
        run: |
          $exe = Get-ChildItem -Path build -Filter *.exe -Recurse | Select-Object -First 1
          echo "exe_path=$($exe.FullName)" >> $env:GITHUB_OUTPUT

      - name: Upload artifact to release
        uses: softprops/action-gh-release@v2
        with:
          files: ${{ steps.find_exe.outputs.exe_path }}
